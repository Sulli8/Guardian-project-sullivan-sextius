{"ast":null,"code":"import _asyncToGenerator from \"/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport config from '../../auth_config.json';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/service-worker\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common/http\";\nexport class ApiService {\n  swPush;\n  router;\n  http;\n  displayMessage = false;\n  NotifsAllowed = false;\n  sub;\n  relanceIntervalId = null;\n  PUBLIC_VAPID_KEY_OF_SERVER = 'BGPhLwNAwJZguAqSPCFEbfN_TkH7tTpe5AVTvrQxAfWEb8-alQBJtx9VLsL3i2T1sWWOKYRabRWq1mRMocUDt4c';\n  notification_data;\n  constructor(swPush, router, http) {\n    this.swPush = swPush;\n    this.router = router;\n    this.http = http;\n  }\n  getNotifications() {\n    return this.http.get(`${config.apiUri}/api/get-notifications`);\n  }\n  getPrescription() {\n    return this.http.get(`${config.apiUri}/api/get-prescriptions`);\n  }\n  getUser() {\n    return this.http.get(`${config.apiUri}/api/get-user`);\n  }\n  exportPrescriptions() {\n    return this.http.get(this.apiUrl, {\n      observe: 'response',\n      responseType: 'blob' // L'API renvoie un fichier binaire (PDF)\n    });\n  }\n  handleRedirection(valeur) {\n    if (valeur) {\n      // Si 'valeur' est true, redirigez vers la page d'accueil\n      this.router.navigate(['/home-page']);\n    } else {\n      // Si 'valeur' est false, redirigez vers la page du questionnaire\n      this.router.navigate(['/questionnaire']);\n    }\n  }\n  submitResponses(responses) {\n    return this.http.post(`${config.apiUri}/api/responses`, responses);\n  }\n  checkIfUserHasAnswered() {\n    return this.http.get(`${config.apiUri}/api/check-answers`);\n  }\n  checkIsSubsribe() {\n    return this.http.get(`${config.apiUri}/api/is-subscribe`);\n  }\n  checkRelanceNotification() {\n    return this.http.get(`${config.apiUri}/api/check-notifications`);\n  }\n  unSubsribeNotifications(sub) {\n    return this.http.put(`${config.apiUri}/api/unsubscribe`, {\n      webpushtoken: sub\n    });\n  }\n  unsubscribeFromNotifications() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const sub = yield _this.swPush.requestSubscription({\n        serverPublicKey: _this.PUBLIC_VAPID_KEY_OF_SERVER\n      });\n      _this.unSubsribeNotifications(sub).subscribe(res => {});\n    })();\n  }\n  // POST request for subscription\n  putSubscription(subscription, relance) {\n    const object = {\n      webpushtoken: subscription\n    };\n    const url = `${config.apiUri}/api/subscription`;\n    return this.http.put(url, object);\n  }\n  // Récupérer toutes les questions depuis l'API\n  getQuestions() {\n    const url = `${config.apiUri}/api/questions`;\n    return this.http.get(url);\n  }\n  // GET request for ping\n  ping$() {\n    return this.http.get(`${config.apiUri}/api/external`);\n  }\n  // GET request for medications\n  getMedications() {\n    const url = `${config.apiUri}/api/medicaments`; // URL de l'API pour récupérer les médicaments\n    return this.http.get(url);\n  }\n  subscribeToPush() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        const sub = yield _this2.swPush.requestSubscription({\n          serverPublicKey: _this2.PUBLIC_VAPID_KEY_OF_SERVER\n        });\n        console.log('sub', sub);\n        _this2.sub = sub;\n        _this2.putSubscription(sub, false).subscribe(res => {});\n      } catch (err) {\n        console.error('Could not subscribe due to:', err);\n      }\n    })();\n  }\n  checkNotify() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const sub = yield _this3.swPush.requestSubscription({\n        serverPublicKey: _this3.PUBLIC_VAPID_KEY_OF_SERVER\n      });\n      const object = {\n        webpushtoken: sub\n      };\n      const url = `${config.apiUri}/api/check-subscribed-notify`; // URL de l'API pour envoyer les prescriptions\n      return _this3.http.post(url, object).toPromise();\n    })();\n  }\n  // POST request for prescriptions\n  postPrescriptions(prescription) {\n    const url = `${config.apiUri}/api/prescriptions`; // URL de l'API pour envoyer les prescriptions\n    console.log(\"PRESCRIPTION : \", prescription);\n    return this.http.post(url, prescription);\n  }\n  // GET request for list of prescriptions\n  getPrescriptions() {\n    const url = `${config.apiUri}/api/list-prescriptions`; // URL de l'API pour récupérer la liste des prescriptions\n    return this.http.get(url);\n  }\n  // GET request for list of prescriptions\n  postRelances(subscription) {\n    const url = `${config.apiUri}/api/start-relance`; // URL de l'API pour récupérer la liste des prescriptions\n    return this.http.post(url, subscription);\n  }\n  // DELETE request for deleting a prescription\n  deletePrescription(id) {\n    const url = `${config.apiUri}/api/prescriptions/${id}`; // Assurez-vous que l'API accepte les requêtes DELETE sur ce point de terminaison\n    return this.http.delete(url);\n  }\n  static ɵfac = function ApiService_Factory(t) {\n    return new (t || ApiService)(i0.ɵɵinject(i1.SwPush), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i3.HttpClient));\n  };\n  static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: ApiService,\n    factory: ApiService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["config","ApiService","swPush","router","http","displayMessage","NotifsAllowed","sub","relanceIntervalId","PUBLIC_VAPID_KEY_OF_SERVER","notification_data","constructor","getNotifications","get","apiUri","getPrescription","getUser","exportPrescriptions","apiUrl","observe","responseType","handleRedirection","valeur","navigate","submitResponses","responses","post","checkIfUserHasAnswered","checkIsSubsribe","checkRelanceNotification","unSubsribeNotifications","put","webpushtoken","unsubscribeFromNotifications","_this","_asyncToGenerator","requestSubscription","serverPublicKey","subscribe","res","putSubscription","subscription","relance","object","url","getQuestions","ping$","getMedications","subscribeToPush","_this2","console","log","err","error","checkNotify","_this3","toPromise","postPrescriptions","prescription","getPrescriptions","postRelances","deletePrescription","id","delete","i0","ɵɵinject","i1","SwPush","i2","Router","i3","HttpClient","factory","ɵfac","providedIn"],"sources":["/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/src/services/api.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport config from '../../auth_config.json';\nimport { Observable } from 'rxjs';\nimport { Question } from 'src/models/question';\nimport { Router } from '@angular/router';\nimport { SwPush } from '@angular/service-worker';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class ApiService {\n  displayMessage = false;\n  NotifsAllowed = false;\n  sub: any;\n  private relanceIntervalId: any = null;\n  PUBLIC_VAPID_KEY_OF_SERVER = 'BGPhLwNAwJZguAqSPCFEbfN_TkH7tTpe5AVTvrQxAfWEb8-alQBJtx9VLsL3i2T1sWWOKYRabRWq1mRMocUDt4c';\n  notification_data: any;\n  constructor(readonly swPush: SwPush,private router: Router,private http: HttpClient) {}\n\n \n  getNotifications():Observable<any>{\n    return this.http.get(`${config.apiUri}/api/get-notifications`);\n  }\n\n  getPrescription():Observable<any>{\n    return this.http.get(`${config.apiUri}/api/get-prescriptions`);\n  }\n\n  getUser():Observable<any>{\n    return this.http.get(`${config.apiUri}/api/get-user`);\n  }\n  exportPrescriptions(): Observable<HttpResponse<Blob>> {\n    return this.http.get(this.apiUrl, {\n      observe: 'response',\n      responseType: 'blob'  // L'API renvoie un fichier binaire (PDF)\n    });\n  }\n\n  handleRedirection(valeur: boolean): void {\n    \n    if (valeur) {\n      // Si 'valeur' est true, redirigez vers la page d'accueil\n     \n      this.router.navigate(['/home-page']);\n     \n    } else {\n      // Si 'valeur' est false, redirigez vers la page du questionnaire\n      this.router.navigate(['/questionnaire']);\n    }\n  }\n\n  submitResponses(responses: any): Observable<any> {\n    return this.http.post(`${config.apiUri}/api/responses`, responses);\n  }\n\n  checkIfUserHasAnswered(): Observable<any> {\n    return this.http.get(`${config.apiUri}/api/check-answers`);\n  }\n\n  checkIsSubsribe(): Observable<any> {\n    return this.http.get(`${config.apiUri}/api/is-subscribe`);\n  }\n\n  checkRelanceNotification(){\n    return this.http.get(`${config.apiUri}/api/check-notifications`);\n  }\n  unSubsribeNotifications(sub:any): Observable<any> {\n    return this.http.put<any>(`${config.apiUri}/api/unsubscribe`, { webpushtoken: sub });\n  }\n  async unsubscribeFromNotifications() {\n    const sub = await this.swPush.requestSubscription({\n      serverPublicKey: this.PUBLIC_VAPID_KEY_OF_SERVER,\n    });\n    this.unSubsribeNotifications(sub).subscribe(res=>{\n\n    })\n  }\n  // POST request for subscription\n  putSubscription(subscription: any,relance:boolean): Observable<any> {\n    const object = {\n      webpushtoken:subscription\n    }\n    const url = `${config.apiUri}/api/subscription`; \n    return this.http.put<any>(url,object);\n  }\n  // Récupérer toutes les questions depuis l'API\n  getQuestions(): Observable<Question[]> {\n    const url = `${config.apiUri}/api/questions`\n    return this.http.get<Question[]>(url);\n  }\n\n  // GET request for ping\n  ping$(): Observable<any> {\n    return this.http.get(`${config.apiUri}/api/external`);\n  }\n\n  // GET request for medications\n  getMedications(): Observable<any> {\n    const url = `${config.apiUri}/api/medicaments`; // URL de l'API pour récupérer les médicaments\n    return this.http.get<any>(url);\n  }\n\n  public async subscribeToPush(){\n    try {\n      const sub = await this.swPush.requestSubscription({\n        serverPublicKey: this.PUBLIC_VAPID_KEY_OF_SERVER,\n      });\n      console.log('sub',sub);\n      this.sub = sub;\n      this.putSubscription(sub,false).subscribe(res=>{\n\n      });      \n    } catch (err) {\n      console.error('Could not subscribe due to:', err);\n    }\n  }\n  async checkNotify():Promise<any>{\n    const sub = await this.swPush.requestSubscription({\n      serverPublicKey: this.PUBLIC_VAPID_KEY_OF_SERVER,\n    });\n    const object = {\n      webpushtoken:sub,\n    }\n    const url = `${config.apiUri}/api/check-subscribed-notify`; // URL de l'API pour envoyer les prescriptions\n    return this.http.post<any>(url,object).toPromise();\n  }\n  // POST request for prescriptions\n  postPrescriptions(prescription: any): Observable<any> {\n    const url = `${config.apiUri}/api/prescriptions`; // URL de l'API pour envoyer les prescriptions\n    console.log(\"PRESCRIPTION : \", prescription);\n    return this.http.post<any>(url, prescription);\n  }\n\n  // GET request for list of prescriptions\n  getPrescriptions(): Observable<any> {\n    const url = `${config.apiUri}/api/list-prescriptions`; // URL de l'API pour récupérer la liste des prescriptions\n    return this.http.get<any>(url);\n  }\n\n    // GET request for list of prescriptions\n    postRelances(subscription: any): Observable<any> {\n      const url = `${config.apiUri}/api/start-relance`; // URL de l'API pour récupérer la liste des prescriptions\n      return this.http.post<any>(url,subscription);\n    }\n\n    // DELETE request for deleting a prescription\n    deletePrescription(id: number): Observable<any> {\n      const url = `${config.apiUri}/api/prescriptions/${id}`; // Assurez-vous que l'API accepte les requêtes DELETE sur ce point de terminaison\n      return this.http.delete<any>(url);\n    }\n\n\n\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}