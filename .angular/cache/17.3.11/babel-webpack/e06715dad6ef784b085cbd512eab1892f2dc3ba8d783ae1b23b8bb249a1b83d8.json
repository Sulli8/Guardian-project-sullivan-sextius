{"ast":null,"code":"import _asyncToGenerator from \"/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { CommonModule } from '@angular/common';\nimport { Component } from '@angular/core';\nimport Swal from 'sweetalert2'; // Import SweetAlert2\nimport { NavBarComponent } from '../nav-bar/nav-bar.component';\nlet NotificationsComponent = class NotificationsComponent {\n  swPush;\n  api;\n  displayMessage = false;\n  NotifsAllowed = false;\n  sub;\n  relanceIntervalId = null;\n  PUBLIC_VAPID_KEY_OF_SERVER = 'BGPhLwNAwJZguAqSPCFEbfN_TkH7tTpe5AVTvrQxAfWEb8-alQBJtx9VLsL3i2T1sWWOKYRabRWq1mRMocUDt4c';\n  notification_data;\n  constructor(swPush, api) {\n    this.swPush = swPush;\n    this.api = api;\n  }\n  notifications = []; // Tableau pour stocker les médicaments\n  getNotifications() {\n    this.api.getNotifications().subscribe(data => {\n      this.notifications = data; // Affecter les médicaments récupérés\n    }, error => {\n      console.error('Erreur lors de la récupération des médicaments:', error);\n    });\n  }\n  ngOnInit() {\n    // Vérification de l'état de la permission des notifications\n    if (Notification.permission === 'granted') {\n      console.log('Notification granted');\n      this.NotifsAllowed = true; // Si l'utilisateur a déjà autorisé, on active le bouton\n    } else if (Notification.permission === 'denied') {\n      this.displayMessage = true; // Si l'utilisateur a refusé, on affiche un message\n    } else {\n      // Si l'utilisateur n'a pas encore pris de décision, on demande la permission\n      Notification.requestPermission().then(permission => {\n        if (permission === 'granted') {\n          this.NotifsAllowed = true; // Si l'utilisateur accepte, on active le bouton\n        } else {\n          this.displayMessage = true; // Sinon, on affiche un message\n        }\n      });\n    }\n    this.checkIsSubscribed(); // Vérifier si l'utilisateur est abonné dès que le composant est initialisé\n  }\n  /**\n   * Vérifie si l'utilisateur est abonné aux notifications\n   */\n  checkIsSubscribed() {\n    this.api.checkIsSubsribe().subscribe(response => {\n      // Vérification de l'état de l'abonnement\n      if (response.isSubscribed) {\n        this.NotifsAllowed = true; // L'utilisateur est abonné\n        this.showSuccessAlert('Vous êtes déjà abonné aux notifications.');\n      } else {\n        this.NotifsAllowed = false; // L'utilisateur n'est pas abonné\n        this.showInfoAlert('Vous n\\'êtes pas encore abonné aux notifications.');\n      }\n    }, error => {\n      this.NotifsAllowed = false;\n      this.showErrorAlert('Erreur lors de la vérification de l\\'abonnement.');\n    });\n  }\n  /**\n   * Désabonne l'utilisateur des notifications push\n   */\n  unsubscribeFromPush() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      try {\n        // Attendre la réponse de l'API pour désabonner l'utilisateur\n        const response = yield _this.api.unsubscribeFromNotifications();\n        _this.showSuccessAlert('Vous avez été désabonné avec succès des notifications.');\n        _this.NotifsAllowed = false; // Mettre à jour l'état NotifsAllowed\n      } catch (error) {\n        // Gérer les erreurs si la requête échoue\n        _this.showErrorAlert('Erreur lors de la désinscription des notifications.');\n      }\n    })();\n  }\n  /**\n   * Souscrire l'utilisateur aux notifications push\n   */\n  subscribeToPush() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        // Attendre la réponse de l'API pour souscrire aux notifications\n        const response = yield _this2.api.subscribeToPush();\n        // Si la souscription réussit, afficher le message de succès\n        _this2.showSuccessAlert('Souscription aux notifications réussie.');\n        _this2.NotifsAllowed = true; // Mettre à jour l'état NotifsAllowed\n      } catch (error) {\n        // Gérer les erreurs si la requête échoue\n        _this2.showErrorAlert('Erreur lors de la souscription aux notifications.');\n      }\n    })();\n  }\n  /**\n   * Afficher une SweetAlert de succès\n   */\n  showSuccessAlert(message) {\n    Swal.fire({\n      icon: 'success',\n      title: 'Succès',\n      text: message\n    });\n  }\n  /**\n   * Afficher une SweetAlert d'information\n   */\n  showInfoAlert(message) {\n    Swal.fire({\n      icon: 'info',\n      title: 'Information',\n      text: message\n    });\n  }\n  /**\n   * Afficher une SweetAlert d'erreur\n   */\n  showErrorAlert(message) {\n    Swal.fire({\n      icon: 'error',\n      title: 'Erreur',\n      text: message\n    });\n  }\n  ngOnDestroy() {\n    if (this.relanceIntervalId) {\n      clearInterval(this.relanceIntervalId);\n    }\n  }\n};\nNotificationsComponent = __decorate([Component({\n  selector: 'app-notifications',\n  templateUrl: './notifications.component.html',\n  styleUrls: ['./notifications.component.css'],\n  imports: [CommonModule, NavBarComponent],\n  standalone: true\n})], NotificationsComponent);\nexport { NotificationsComponent };","map":{"version":3,"names":["CommonModule","Component","Swal","NavBarComponent","NotificationsComponent","swPush","api","displayMessage","NotifsAllowed","sub","relanceIntervalId","PUBLIC_VAPID_KEY_OF_SERVER","notification_data","constructor","notifications","getNotifications","subscribe","data","error","console","ngOnInit","Notification","permission","log","requestPermission","then","checkIsSubscribed","checkIsSubsribe","response","isSubscribed","showSuccessAlert","showInfoAlert","showErrorAlert","unsubscribeFromPush","_this","_asyncToGenerator","unsubscribeFromNotifications","subscribeToPush","_this2","message","fire","icon","title","text","ngOnDestroy","clearInterval","__decorate","selector","templateUrl","styleUrls","imports","standalone"],"sources":["/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/src/app/components/notifications/notifications.component.ts"],"sourcesContent":["import { CommonModule } from '@angular/common';\nimport { Component, OnDestroy, OnInit } from '@angular/core';\nimport { SwPush } from '@angular/service-worker';\nimport Swal from 'sweetalert2'; // Import SweetAlert2\nimport { ApiService } from '../../../services/api.service';\nimport { NavBarComponent } from '../nav-bar/nav-bar.component';\n\n@Component({\n  selector: 'app-notifications',\n  templateUrl: './notifications.component.html',\n  styleUrls: ['./notifications.component.css'],\n  imports: [CommonModule, NavBarComponent],\n  standalone: true\n})\nexport class NotificationsComponent implements OnInit, OnDestroy {\n  displayMessage = false;\n  NotifsAllowed = false;\n  sub: any;\n  private relanceIntervalId: any = null;\n  PUBLIC_VAPID_KEY_OF_SERVER = 'BGPhLwNAwJZguAqSPCFEbfN_TkH7tTpe5AVTvrQxAfWEb8-alQBJtx9VLsL3i2T1sWWOKYRabRWq1mRMocUDt4c';\n  notification_data: any;\n \n  constructor(readonly swPush: SwPush, private api: ApiService) {\n  \n  }\n  notifications: any[] = []; // Tableau pour stocker les médicaments\n\n  getNotifications(){\n    this.api.getNotifications().subscribe(\n      (data) => {\n        this.notifications = data;  // Affecter les médicaments récupérés\n      },\n      (error) => {\n        console.error('Erreur lors de la récupération des médicaments:', error);\n      }\n    );\n  }\n\n\n\n\n  ngOnInit(): void {\n    // Vérification de l'état de la permission des notifications\n    if (Notification.permission === 'granted') {\n      console.log('Notification granted');\n      this.NotifsAllowed = true; // Si l'utilisateur a déjà autorisé, on active le bouton\n    } else if (Notification.permission === 'denied') {\n      this.displayMessage = true; // Si l'utilisateur a refusé, on affiche un message\n    } else {\n      // Si l'utilisateur n'a pas encore pris de décision, on demande la permission\n      Notification.requestPermission().then(permission => {\n        if (permission === 'granted') {\n          this.NotifsAllowed = true; // Si l'utilisateur accepte, on active le bouton\n        } else {\n          this.displayMessage = true; // Sinon, on affiche un message\n        }\n      });\n    }\n    this.checkIsSubscribed();  // Vérifier si l'utilisateur est abonné dès que le composant est initialisé\n  }\n\n  /**\n   * Vérifie si l'utilisateur est abonné aux notifications\n   */\n  checkIsSubscribed(): void {\n    this.api.checkIsSubsribe().subscribe(\n      (response) => {\n        // Vérification de l'état de l'abonnement\n        if (response.isSubscribed) {\n          this.NotifsAllowed = true;  // L'utilisateur est abonné\n          this.showSuccessAlert('Vous êtes déjà abonné aux notifications.');\n        } else {\n          this.NotifsAllowed = false; // L'utilisateur n'est pas abonné\n          this.showInfoAlert('Vous n\\'êtes pas encore abonné aux notifications.');\n        }\n      },\n      (error) => {\n        this.NotifsAllowed = false;\n        this.showErrorAlert('Erreur lors de la vérification de l\\'abonnement.');\n      }\n    );\n  }\n\n  /**\n   * Désabonne l'utilisateur des notifications push\n   */\n  async unsubscribeFromPush(): Promise<void> {\n    try {\n      // Attendre la réponse de l'API pour désabonner l'utilisateur\n      const response = await this.api.unsubscribeFromNotifications();\n      this.showSuccessAlert('Vous avez été désabonné avec succès des notifications.');\n      this.NotifsAllowed = false;  // Mettre à jour l'état NotifsAllowed\n    } catch (error) {\n      // Gérer les erreurs si la requête échoue\n      this.showErrorAlert('Erreur lors de la désinscription des notifications.');\n    }\n  }\n\n  /**\n   * Souscrire l'utilisateur aux notifications push\n   */\n  async subscribeToPush(): Promise<void> {\n    try {\n      // Attendre la réponse de l'API pour souscrire aux notifications\n      const response = await this.api.subscribeToPush();\n\n      // Si la souscription réussit, afficher le message de succès\n      this.showSuccessAlert('Souscription aux notifications réussie.');\n      this.NotifsAllowed = true;  // Mettre à jour l'état NotifsAllowed\n    } catch (error) {\n      // Gérer les erreurs si la requête échoue\n      this.showErrorAlert('Erreur lors de la souscription aux notifications.');\n    }\n  }\n\n  /**\n   * Afficher une SweetAlert de succès\n   */\n  private showSuccessAlert(message: string): void {\n    Swal.fire({\n      icon: 'success',\n      title: 'Succès',\n      text: message,\n    });\n  }\n\n  /**\n   * Afficher une SweetAlert d'information\n   */\n  private showInfoAlert(message: string): void {\n    Swal.fire({\n      icon: 'info',\n      title: 'Information',\n      text: message,\n    });\n  }\n\n  /**\n   * Afficher une SweetAlert d'erreur\n   */\n  private showErrorAlert(message: string): void {\n    Swal.fire({\n      icon: 'error',\n      title: 'Erreur',\n      text: message,\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.relanceIntervalId) {\n      clearInterval(this.relanceIntervalId);\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}