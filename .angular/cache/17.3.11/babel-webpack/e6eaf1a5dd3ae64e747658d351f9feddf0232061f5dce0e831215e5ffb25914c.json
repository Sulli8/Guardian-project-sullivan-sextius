{"ast":null,"code":"import _asyncToGenerator from \"/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/service-worker\";\nimport * as i2 from \"../../../services/api.service\";\nfunction NotificationsComponent_p_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Merci d'autoriser les notifications dans votre navigateur\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction NotificationsComponent_pre_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"pre\");\n    i0.ɵɵtext(1, \"    \");\n    i0.ɵɵelement(2, \"code\", 2);\n    i0.ɵɵpipe(3, \"json\");\n    i0.ɵɵtext(4, \"\\n  \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"innerHTML\", i0.ɵɵpipeBind1(3, 1, ctx_r0.sub), i0.ɵɵsanitizeHtml);\n  }\n}\nexport class NotificationsComponent {\n  swPush;\n  api;\n  displayMessage = false;\n  NotifsAllowed = false;\n  sub;\n  PUBLIC_VAPID_KEY_OF_SERVER = 'BISCiKs78JcYBoUgKqEMDMdeqZehBmtIBrvkotjdEKDHHYO87hvYy3H9VTYwWXnjHdMX_m2XmXn_nL6C1dxxw8o';\n  constructor(swPush, api) {\n    this.swPush = swPush;\n    this.api = api;\n    if (Notification.permission === 'granted') {\n      console.log('notif granted');\n      this.NotifsAllowed = true;\n    } else if (Notification.permission === 'denied') {\n      this.displayMessage = true;\n      Notification.requestPermission().then(permission => {\n        if (permission === 'granted') {\n          this.NotifsAllowed = true;\n        }\n      });\n    } else {\n      Notification.requestPermission().then(permission => {\n        if (permission === 'granted') {\n          this.NotifsAllowed = true;\n        }\n      });\n    }\n  }\n  subscribeToPush() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      console.log('Starting subscription process...');\n      try {\n        if (Notification.permission !== 'granted') {\n          console.warn('Notifications permission is not granted.');\n          return;\n        }\n        if (!_this.swPush.isEnabled) {\n          console.error('Service Workers are not enabled in this environment.');\n          return;\n        }\n        if (!_this.PUBLIC_VAPID_KEY_OF_SERVER) {\n          console.error('Public VAPID key is missing.');\n          return;\n        }\n        console.log('Requesting subscription...');\n        const sub = yield _this.swPush.requestSubscription({\n          serverPublicKey: _this.PUBLIC_VAPID_KEY_OF_SERVER\n        });\n        console.log('Subscription successful:', JSON.stringify(sub, null, 2));\n        _this.sub = sub;\n        _this.api.postSubscription(sub).subscribe({\n          next: res => console.log('Subscription successfully sent to server:', res),\n          error: err => console.error('Error sending subscription to server:', err)\n        });\n      } catch (err) {\n        console.error('Could not subscribe due to:', err);\n        if (err instanceof Error) {\n          console.error('Error message:', err.message);\n          console.error('Stack trace:', err.stack);\n        }\n      }\n      console.log('Subscription process complete.');\n    })();\n  }\n  static ɵfac = function NotificationsComponent_Factory(t) {\n    return new (t || NotificationsComponent)(i0.ɵɵdirectiveInject(i1.SwPush), i0.ɵɵdirectiveInject(i2.ApiService));\n  };\n  static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: NotificationsComponent,\n    selectors: [[\"app-notifications\"]],\n    decls: 4,\n    vars: 3,\n    consts: [[4, \"ngIf\"], [1, \"button\", \"is-primary\", 3, \"click\", \"disabled\"], [3, \"innerHTML\"]],\n    template: function NotificationsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, NotificationsComponent_p_0_Template, 2, 0, \"p\", 0);\n        i0.ɵɵelementStart(1, \"button\", 1);\n        i0.ɵɵlistener(\"click\", function NotificationsComponent_Template_button_click_1_listener() {\n          return ctx.subscribeToPush();\n        });\n        i0.ɵɵtext(2, \"Souscrire aux notifications\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(3, NotificationsComponent_pre_3_Template, 5, 3, \"pre\", 0);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.displayMessage);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"disabled\", !ctx.NotifsAllowed);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.sub);\n      }\n    },\n    styles: [\"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"names":["i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵelement","ɵɵadvance","ɵɵproperty","ɵɵpipeBind1","ctx_r0","sub","ɵɵsanitizeHtml","NotificationsComponent","swPush","api","displayMessage","NotifsAllowed","PUBLIC_VAPID_KEY_OF_SERVER","constructor","Notification","permission","console","log","requestPermission","then","subscribeToPush","_this","_asyncToGenerator","warn","isEnabled","error","requestSubscription","serverPublicKey","JSON","stringify","postSubscription","subscribe","next","res","err","Error","message","stack","ɵɵdirectiveInject","i1","SwPush","i2","ApiService","selectors","decls","vars","consts","template","NotificationsComponent_Template","rf","ctx","ɵɵtemplate","NotificationsComponent_p_0_Template","ɵɵlistener","NotificationsComponent_Template_button_click_1_listener","NotificationsComponent_pre_3_Template"],"sources":["/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/src/app/components/notifications/notifications.component.ts","/Users/sullivan/Desktop/Guardian-project-sullivan-sextius/Guardian-project-sullivan-sextius/src/app/components/notifications/notifications.component.html"],"sourcesContent":["import { Component } from '@angular/core';\nimport { SwPush } from '@angular/service-worker';\nimport { ApiService } from '../../../services/api.service';\n\n@Component({\n  selector: 'app-notifications',\n  templateUrl: './notifications.component.html',\n  styleUrls: ['./notifications.component.scss']\n})\nexport class NotificationsComponent {\n  displayMessage = false;\n  NotifsAllowed = false;\n  sub:any;\n  PUBLIC_VAPID_KEY_OF_SERVER = 'BISCiKs78JcYBoUgKqEMDMdeqZehBmtIBrvkotjdEKDHHYO87hvYy3H9VTYwWXnjHdMX_m2XmXn_nL6C1dxxw8o';\n\n  constructor(readonly swPush: SwPush,private api:ApiService) {\n    if (Notification.permission === 'granted') {\n      console.log('notif granted');\n      this.NotifsAllowed = true;\n    } else if (Notification.permission === 'denied') {\n      this.displayMessage = true;\n        Notification.requestPermission().then(permission => {\n          if (permission === 'granted') {\n            this.NotifsAllowed = true;\n          }\n        });\n    } else {\n      Notification.requestPermission().then(permission => {\n        if (permission === 'granted') {\n          this.NotifsAllowed = true;\n        }\n      });\n    }\n  }\n\n\n  public async subscribeToPush() {\n    console.log('Starting subscription process...');\n    try {\n      if (Notification.permission !== 'granted') {\n        console.warn('Notifications permission is not granted.');\n        return;\n      }\n  \n      if (!this.swPush.isEnabled) {\n        console.error('Service Workers are not enabled in this environment.');\n        return;\n      }\n  \n      if (!this.PUBLIC_VAPID_KEY_OF_SERVER) {\n        console.error('Public VAPID key is missing.');\n        return;\n      }\n  \n      console.log('Requesting subscription...');\n      const sub = await this.swPush.requestSubscription({\n        serverPublicKey: this.PUBLIC_VAPID_KEY_OF_SERVER,\n      });\n  \n      console.log('Subscription successful:', JSON.stringify(sub, null, 2));\n      this.sub = sub;\n  \n      this.api.postSubscription(sub).subscribe({\n        next: (res) => console.log('Subscription successfully sent to server:', res),\n        error: (err) => console.error('Error sending subscription to server:', err),\n      });\n    } catch (err) {\n      console.error('Could not subscribe due to:', err);\n      if (err instanceof Error) {\n        console.error('Error message:', err.message);\n        console.error('Stack trace:', err.stack);\n      }\n    }\n    console.log('Subscription process complete.');\n  }\n  \n\n}\n","<p *ngIf=\"displayMessage\">Merci d'autoriser les notifications dans votre navigateur</p>\n<button [disabled]=\"!NotifsAllowed\" (click)=\"subscribeToPush()\" class=\"button is-primary\">Souscrire aux notifications</button>\n<pre *ngIf=\"sub\">\n    <code [innerHTML]=\"sub | json\"></code>\n  </pre>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}